{% extends "base.html" %}
{% block content %}

<div class="row">
  <div class="col-12 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">

        <form method="GET" action="">
          <div class="d-flex align-items-center justify-content-between p-3 mb-4" style="border-radius:6px;">


          <a class="fw-bold text-primary" href="">Áreas Temáticas</a>
            
            <div class="flex-grow-1 mx-3">
              <input type="text" name="q" class="form-control" placeholder="Busca por Publicações..." value="{{ request.GET.q }}">
            </div>

            <select name="filtro" class="form-control" style="width: 20%;" onchange="this.form.submit()">
              <option value="" {% if not request.GET.filtro %}selected{% endif %}>Últimas Publicações</option>
              <option value="antiga-publicacao" {% if request.GET.filtro == 'antiga-publicacao' %}selected{% endif %}>Antigas Publicações</option>
              <option value="a-z" {% if request.GET.filtro == 'a-z' %}selected{% endif %}>A-Z</option>
              <option value="z-a" {% if request.GET.filtro == 'z-a' %}selected{% endif %}>Z-A</option>
            </select>
            

          </div>
        </form>

        <h2 class="card-title mb-3">Resultados</h2>

        {% if projetos %}
        <div class="table-responsive"> 
          <table class="table">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Autor</th>
                <th>Equipe</th>
                <th>Data de Criação</th>
                <th>Última Atualização</th>
                <th>Tags</th>
                <th>Visualizar projeto</th>
              </tr>
            </thead>
            <tbody>
              {% for projeto in projetos %}
              <tr>
                <td>{{ projeto.nome }}</td>
                <td>{{ projeto.autor.get_full_name|default:projeto.autor.username }}</td>
                <td>{{ projeto.equipe.nome|default:"Nenhuma equipe" }}</td>
                <td>{{ projeto.data_criacao|date:"d/m/Y H:i" }}</td>
                <td>{{ projeto.data_atualizacao|date:"d/m/Y H:i" }}</td>
                <td>
                  {% for tag in projeto.tags.all %}
                    <span class="badge bg-dark text-white mr-2">{{ tag.nome }}</span>
                  {% empty %}
                    <span class="text-muted">Sem tags</span>
                  {% endfor %}
                </td>
                <td><a href="{% url 'projeto:projeto_detail' projeto.id %}" class="btn btn-sm btn-primary">Ver Detalhes</a></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted">Nenhum projeto encontrado com os filtros aplicados.</p>
        {% endif %}

      </div>
    </div>
  </div>
</div>

{% endblock %}